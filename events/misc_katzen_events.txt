namespace = pki_misc

country_event = {
	id = pki_misc.1
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		has_origin = origin_katzen
		has_tradition = tr_katzen_planetside_garrisons
	}
	immediate = {
		every_controlled_planet = {
			limit = {
				NOT = {
					has_planet_flag = pki_flusion_planet
					any_planet_army = {
						army_type = peacekeeper_army
					}
				}
				has_ground_combat = no
				is_colony = yes
			}
			while = {
				count = 1
				create_army = {
					name = "Katzenarmee Colonial Garrison"
					owner = event_target:pki_player
					species = owner_main_species
					type = "peacekeeper_army"

				}
			}
		}
	}
}

country_event = {
	id = pki_misc.3
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		has_origin = origin_katzen
	}
	immediate = {
		set_variable = { #count total systems, used so kaiser can change the name
			which = "player_katzen_galaxy_total_system_count"
			value = 0
		}
		every_system = { #every system in galaxy adds 1
			event_target:pki_player = {
				change_variable = {
					which = "player_katzen_galaxy_total_system_count"
					value = 1
				}
			}
		}
		set_variable = { #count katzen systems, used so kaiser can change the name
			which = player_katzen_total_system_count
			value = 0
		}
		every_system_within_border = { #count katzen systems
			event_target:pki_player = {
				change_variable = {
					which = player_katzen_total_system_count
					value = 1
				}
			}
		}
		every_subject = {
			every_system_within_border = { #count katzen systems
				event_target:pki_player = {
					change_variable = {
						which = player_katzen_total_system_count
						value = 1
					}
				}
			}
		}
		set_variable = { #check for greater katzen imperium
			which = "player_greater_imperium_limit"
			value = player_katzen_galaxy_total_system_count
		}
		multiply_variable = { #the limit to form greater imperium is 45% the total systems
			which = "player_greater_imperium_limit"
			value = 0.45
		}
		set_variable = { #check for galactic katzen imperium
			which = "player_galactic_imperium_limit"
			value = player_katzen_galaxy_total_system_count
		}
		multiply_variable = { #the limit to form galactic imperium is 75% the total systems
			which = "player_galactic_imperium_limit"
			value = 0.75
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = player_big_katzen_empire_formed
				}
				check_variable = {
					which = player_katzen_total_system_count
					value >= player_greater_imperium_limit
				}
			}
			set_country_flag = player_big_katzen_empire_formed
			change_country_flag = {
				icon = {
					category="domination"
					file="domination_3.dds"
				}
				background = {
					category="backgrounds"
					file="v.dds"
				}
				colors = {
					"indigo"
					"dark_purple"
					"null"
					"null"
				}
			}
			set_name = "NAME_BIG_KATZEN_EMPIRE"
			every_country = { country_event = { id = pki_misc.4 } }
		}
		if = {
			limit = {
				NOT = {
					has_country_flag = player_galactic_katzen_empire_formed
				}
				check_variable = {
					which = player_katzen_total_system_count
					value >= player_galactic_imperium_limit
				}
			}
			set_country_flag = player_galactic_katzen_empire_formed
			change_country_flag = {
				icon = {
					category="domination"
					file="domination_18.dds"
				}
				background = {
					category="backgrounds"
					file="circle.dds"
				}
				colors = {
					"indigo"
					"dark_blue"
					"null"
					"null"
				}
			}
			set_name = "NAME_GALACTIC_KATZEN_EMPIRE"
			every_country = { country_event = { id = pki_misc.5 } }
		}
	}
}

country_event = { #big
	id = pki_misc.4
	title = "pki_misc.4.name"
	desc = "pki_misc.4.desc"

	picture = GFX_evt_grand_speech
	show_sound = event_celebration
	location = from
	is_triggered_only = yes

	option = { #aw
		name = "pki_misc.4.a"
		trigger = {
			NOT = {
				has_origin = origin_katzen
			}
		}
	}
	option = { #:KaiserPog:
		name = "pki_misc.4.b"
		trigger = {
			has_origin = origin_katzen
		}
	}
}

country_event = { #galactic
	id = pki_misc.5
	title = "pki_misc.5.name"
	desc = "pki_misc.5.desc"

	picture = GFX_evt_grand_speech
	show_sound = event_celebration
	location = from
	is_triggered_only = yes

	option = { #aw
		name = "pki_misc.5.a"
		trigger = {
			NOT = {
				has_origin = origin_katzen
			}
		}
	}
	option = { #:KaiserPog:
		name = "pki_misc.5.b"
		trigger = {
			has_origin = origin_katzen
		}
	}
}

country_event = {
	id = pki_misc.6
	title = pki_misc.6.title
	desc = pki_misc.6.desc
	show_sound = par_portrait_02
	picture = GFX_leader_recruitment_bg_renowned
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		has_paragon_dlc = yes
	}

	event_window_type = leader_recruit

	immediate = {
		ethic_leader_creator = {
			SPECIES_CLASS = MAM
			LEADER_PORTRAIT = mam14
			CLASS = commander
			NAME = NAME_gunfur
			LEVEL = 4
			GENDER = male
			IMMORTAL = no
			ETHIC = militarist
			DESC = gunfurdesc
			CATCH_PHRASE = gunfur_catch_phrase
		}
		last_created_leader = {
			add_trait = subclass_commander_general
			add_trait = leader_trait_gunfur
			add_trait = pki_katzen_trait_elite
			add_trait = leader_trait_butcher_2
			add_trait = leader_trait_victory_or_death
			set_age = 32
			save_global_event_target_as = gunfur
		}
	}

	picture_event_data = {
		portrait = event_target:ethic_leader
		room = ethic_spaceship_room
	}

	option = {
		name = DISMISS
		tag = dismiss_leader
		hidden_effect = {
			event_target:gunfur = {
				kill_leader = {
					show_notification = no
				}
			}
		}
	}
	option = {
		name = pki_misc.6.a
		response_text = pki_misc.6.a.response
		is_dialog_only = yes
	}
	option = {
		name = pki_misc.6.b
		response_text = pki_misc.6.b.response
		is_dialog_only = yes
	}
	option = {
		name = pki_misc.6.c
		response_text = pki_misc.6.c.response
		is_dialog_only = yes
	}
	option = {
		name = HIRE
		tag = hire_leader
		custom_tooltip = pki_misc.6.hire_custom_tooltip
		hidden_effect = {
			ethic_leader_hire_effect = {
				GLOBAL_EVENT_TARGET = gunfur
			}
			create_fleet = {
				name = "GroÃŸdominiontracks Force"
				effect = {
					set_owner = root
					while = {
						count = 1
						create_army_transport = {
							army_type = dominion_tracks
							army_name = "NAME_dominiontracks"
							ship_name = "NAME_dominiontracks"
						}
						 
					}
					set_location = {
						target = root.capital_scope
					}
				}
			}
			last_created_army = {
				assign_leader = event_target:gunfur
			}
		}
	}
}

country_event = {
	id = pki_misc.7
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		#FROMFROMFROM = { # Planet where ground combat is taking place.
		#	random_ground_combat_attacker = {
		#		limit = {
		#			exists = leader
		#			leader = {
		#				has_trait = leader_trait_gunfur
		#			}
		#		}
		#		leader = {
		#			save_event_target_as = gunfur_loot
		#		}
		#	}
		#	random_ground_combat_defender = {
		#		limit = {
		#			exists = leader
		#			leader = {
		#				has_trait = leader_trait_gunfur
		#			}
		#		}
		#		leader = {
		#			save_event_target_as = gunfur_loot
		#		}
		#	}
		#}
		#
		## If attacking army has a leader with Crusader trait, award Unity.
		#if = {
		#	limit = { exists = event_target:gunfur_loot }
		#	FROMFROM = {
		#		if = {
		#			limit = {
		#				event_target:gunfur_loot = {
		#					has_trait = leader_trait_gunfur
		#				}
		#			}
		#			add_resource = {
		#				alloys = 10
		#				energy = 25
		#				minerals = 25
		#				food = 25
		#			}
		#		}
		#	}
		from = {
			if = {
				limit = {
					exists = leader
					leader = { has_trait = leader_trait_gunfur }
				}
				prev = {
					add_resource = {
						alloys = 10
						energy = 25
						minerals = 25
						food = 25
					}
				}
			}
		}
	}
}

country_event = {
	id = pki_misc.9
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		pki_is_katzenartig_imperium = yes
		has_policy_flag = derega_kaiser
	}

	immediate = {
		ruler = {
			change_species = event_target:pki_kaiser_portrait_hd
			change_leader_portrait = event_target:pki_kaiser_portrait_hd
		}
	}
}

country_event = {
	id = pki_misc.8
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_origin = origin_katzen
		has_policy_flag = pvz_cattail
	}

	immediate = {
		ruler = {
			change_species = event_target:pki_kaiser_portrait_pvz
			change_leader_portrait = event_target:pki_kaiser_portrait_pvz
		}
	}
}

#country_event = {
#	id = pki_misc.10
#	hide_window = yes
#	is_triggered_only = yes
#	trigger = {
#		has_origin = origin_katzen
#		ruler = {
#			NOT = {
#				has_leader_flag = kaiser_kattail
#			}
#		}
#	}
#	immediate = {
#		if = {
#			limit = { NOT = {
#				any_owned_leader = {
#					has_leader_flag = kaiser_kattail
#				}
#			} }
#			create_leader = {
#				class = commander
#				species = event_target:kaiser_portrait_hd
#				name = "Kattail"
#				skill = 4
#				gender = male
#				immortal = yes
#				set_age = 189
#				traits = {
#					trait = subclass_commander_councilor
#					trait = leader_trait_ruler_kaiser_cattail
#					trait = trait_ruler_charismatic_2
#					trait = trait_ruler_military_pioneer
#					trait = leader_trait_intimidator
#				}
#				effect = {
#					set_leader_flag = kaiser_kattail
#					save_global_event_target_as = kaiser_kattail
#					event_target:pki_player = {
#						ruler = {
#							unassign_leader = this
#						}
#						assign_leader = event_target:kaiser_kattail
#					}
#				}
#			}
#		}
#		else = {
#			if = {
#				limit = { ruler = {
#					NOT = {
#						has_leader_flag = kaiser_kattail
#					}
#				} }
#				ruler = {
#					unassign_leader = this
#				}
#				assign_leader = event_target:kaiser_kattail
#			}
#		}
#	}
#}

#Aeternum Insights
country_event = {
	id = pki_misc.11
	is_triggered_only = yes
	title = pki_misc.11.title
	desc = pki_misc.11.desc
	picture = GFX_evt_legendary_leader
	show_sound = event_factions
	event_window_type = leader_story

	picture_event_data = {
		portrait = root.owner.ruler
		room = root.owner
	}

	option = {
		name = pki_misc.11.a
		custom_tooltip = pki_misc.11.a.tt
		hidden_effect = {
			increase_aeternite_intel = yes
			increase_aeternite_intel = yes
			increase_aeternite_intel = yes
		}
	}
}

planet_event = {
	id = pki_misc.12
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				OR = {
					owner = { NOT = { has_origin = origin_katzen } }
					is_colony = no
				}
			}
			if = {
				limit = { is_colony = yes }
				save_event_target_as = destroyed_siegfried_world
				owner = { country_event = { id = pki_misc.13 } }
				destroy_colony = yes
			}
			remove_all_buildings = yes
			remove_all_districts = yes
			change_pc = pc_katzenland
			set_planet_entity = {
				entity = katzenland_01_entity
			}
			add_modifier = {
				modifier = "irradiated_desert_planet"
				days = -1
			}
			while = {
				count = 12
				create_katzenland_deposits = yes
			}
			solar_system = {
				remove_star_flag = siegfried_anti_jump_star
				every_neighbor_system = { remove_star_flag = siegfried_anti_jump_star }
			}
		}
		else = {
			planet_event = { id = pki_misc.12 days = 30 }
		}
	}
}

country_event = {
	id = pki_misc.13
	title = "giga_katzen.121.name"
	desc = "giga_katzen.121.desc"
	is_triggered_only = yes
	picture = GFX_evt_exploding_planet
	show_sound = event_super_explosion
	location = event_target:destroyed_siegfried_world


	option = { #NOOOO
		name = "giga_katzen.121.a"
		custom_tooltip = "giga_katzen.121.a.tooltip"
	}
}

country_event = {
	id = pki_misc.14
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		resource_stockpile_compare = {
			resource = alloys
			value >= 1000
		}
		any_planet_within_border = {
			NOT = {
				has_planet_flag = war_forge
			}
		}
		has_edict = katzen_war_forge_construction
	}
	immediate = {
		random_planet_within_border = {
			limit = {
				NOT = {
					has_planet_flag = war_forge
				}
				is_star = no
				OR = {
					habitable_planet = yes
					is_planet_class = pc_pki_flusion_ecu
					is_planet_class = pc_nuked
				}
				is_artificial = no
				giga_habitable_structure = no
				is_colony = yes
				owner = {
					is_primitive = no
				}
			}
			planet.owner = {
				add_resource = {
					alloys = -1000
				}
			}
			solar_system = {
				spawn_megastructure = {
					type = katzen_war_forge_0
					planet = prev
					owner = space_owner
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = katzen_war_forge_0
						planet = { is_same_value = PREVPREVPREV } 
					}
					upgrade_megastructure_to = katzen_war_forge_1
				}
			}
			set_planet_flag = war_forge
		}
	}
}

country_event = {
	id = pki_misc.15
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		pki_is_katzenartig_imperium = yes
	}
	immediate = {
		every_megastructure = { #Delete any finished war forges in system with ONLY hostile ships
			limit = {
				is_megastructure_type = katzen_war_forge_1
				solar_system = {
					any_fleet_in_system = { #no hostiles
						controller = {
							OR = {
								is_at_war_with = event_target:pki_player
								is_hostile = event_target:pki_player
							}
						}
					}
					NOT = { #No katzens
						any_fleet_in_system = {
							owner = { pki_is_katzenartig_imperium = yes }
						}
					}
				}
			}
			remove_megastructure = THIS
			solar_system = {
				save_event_target_as = war_forge_destroyed_system
				every_system_planet = {
					limit = { has_planet_flag = war_forge }
					remove_planet_flag = war_forge
				}
				space_owner = { country_event = { id = pki_misc.16 } }
			}
		}
	}
}

## Replaces missing fleets
country_event = {
	id = pki_misc.151
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		pki_is_katzenartig_imperium = yes
		any_system_within_border = {
			has_megastructure = katzen_war_forge_1
			NOT = {
				any_fleet_in_system = {
					has_fleet_flag = warforge_platform
				}
			}
		}
	}

	immediate = {
		every_system_within_border = {
			limit = {
				has_megastructure = katzen_war_forge_1
				NOT = {
					any_fleet_in_system = {
						has_fleet_flag = warforge_platform
					}
				}
			}
			every_system_megastructure = {
				if = {
					limit = {
						prev = {
							any_fleet_in_system = {
								NOT = {
									has_fleet_flag = warforge_platform@prevprev
								}
							}
						}
					}
					create_fleet = {
						name = "Katzenkriegsschmiedekanone"
						settings = {
							spawn_debris = no
						}
						effect = {
							set_owner = root
							if = {
								limit = {
									prev = {
										space_owner = {
											NOT = {
												pki_is_katzenartig_imperium = yes
											}
										}
									}
								}
								set_owner = event_target:pki_warforge_country
							}
							create_ship = {
								name = "Katzenkriegsschmiedekanone"
								design = "Rhawn"
								upgradable = no
							}
							set_location = prev
							set_fleet_flag = warforge_platform@prev
						}
					}
				}
			}
		}
	}
}

country_event = { #Warforge destroyed
	id = pki_misc.16
	title = "giga_katzen.031.name"
	desc = "giga_katzen.031.desc"
	picture = GFX_evt_large_explosion
	show_sound = event_structural_collapse

	location = from
	is_triggered_only = yes

	option = {
		name = "giga_katzen.031.a"
		add_resource = {
			alloys = 500
			minerals = 500
			engineering_research = 1000
			influence = 25
		}
	}
}

fleet_event = {
	id = pki_misc.17
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = {
			exists = planet
			exists = planet_owner
			planet_owner = {
				is_at_war_with = event_target:pki_player
				NOT = {
					has_origin = origin_katzen
				}
			}
			any_fleet_in_orbit = {
				is_ship_size = pki_submarine
				owner = { has_origin = origin_katzen }
				is_cloaked = yes
			}
		}
	}

	immediate = {
		from = {
			add_modifier = {
				modifier = pki_katzen_submarine_subspace_blockade
				days = -1
			}
			planet_event = {
				id = pki_misc.171
				days = 30
			}
		}
	}
}

planet_event = {
	id = pki_misc.171
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				any_fleet_in_orbit = {
					is_ship_size = pki_submarine
					owner = { has_origin = origin_katzen }
					is_cloaked = yes
				}
			}
			add_modifier = {
				modifier = pki_katzen_submarine_subspace_blockade
				days = -1
			}
			planet_event = {
				id = pki_misc.171
				days = 30
			}
		}
		else = {
			remove_modifier = pki_katzen_submarine_subspace_blockade
		}
	}

}

country_event = {
	id = pki_misc.18
	title = pki_misc.18.title
	desc = pki_misc.18.desc
	show_sound = par_portrait_14
	picture = GFX_leader_recruitment_bg_renowned
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		has_paragon_dlc = yes
	}

	event_window_type = leader_recruit

	immediate = {
		ethic_leader_creator = {
			SPECIES_CLASS = MAM
			LEADER_PORTRAIT = mam14
			CLASS = commander
			NAME = NAME_neumeyer
			LEVEL = 4
			GENDER = male
			IMMORTAL = no
			ETHIC = xenophobe
			DESC = neumeyerdesc
			CATCH_PHRASE = neumeyer_catch_phrase
		}
		last_created_leader = {
			add_trait = subclass_commander_governor
			add_trait = leader_trait_neumeyer
			add_trait = pki_katzen_trait_elite
			add_trait = leader_trait_enlister
			add_trait = leader_trait_embezzler
			set_age = 28
			save_global_event_target_as = pki_neumeyer
		}
	}

	picture_event_data = {
		portrait = event_target:ethic_leader
		room = ethic_spaceship_room
	}

	option = {
		name = DISMISS
		tag = dismiss_leader
		hidden_effect = {
			ethic_leader_kill_effect = yes
		}
	}
	option = {
		name = pki_misc.18.a
		response_text = pki_misc.18.a.response
		is_dialog_only = yes
	}
	option = {
		name = pki_misc.18.b
		response_text = pki_misc.18.b.response
		is_dialog_only = yes
	}
	option = {
		name = pki_misc.18.c
		response_text = pki_misc.18.c.response
		is_dialog_only = yes
	}
	option = {
		name = HIRE
		tag = hire_leader
		custom_tooltip = pki_misc.18.hire_custom_tooltip
		hidden_effect = {
			ethic_leader_hire_effect = {
				GLOBAL_EVENT_TARGET = pki_neumayer
			}
		}
	}
}

country_event = {
	id = pki_misc.19
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		has_paragon_dlc = yes
		has_origin = origin_katzen
		has_country_flag = pki_unified_flusion
		any_owned_sector = {
			NOT = {
				has_sector_type = core_sector
			}
		}
	}
	immediate = {
		country_event = {
			id = pki_misc.18
			days = 180 random = 180
		}
	}
}



### Vassal Stuff

event = {
	id = pki_misc.20
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		any_country = {
			has_origin = origin_katzen
		}
	}
	immediate = {
		every_megastructure = {
			limit = {
				OR = {
					is_megastructure_type = katzen_war_forge_0
					is_megastructure_type = katzen_war_forge_1
				}
				solar_system = {
					NOT = {
						any_fleet_in_system = { #no hostiles
							controller = {
								OR = {
									is_at_war_with = event_target:pki_player
									is_hostile = event_target:pki_player
								}
							}
						}
					}
				}
			}
			set_owner = event_target:pki_player
		}
	}
}

#Spawns peacekeepers
country_event = {
	id = pki_misc.211
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		pki_is_katzprotektorat = yes
		NOT = { is_at_war_with = event_target:pki_player }
	}
	immediate = {
		every_controlled_planet = {
			limit = {
				NOT = {
					any_planet_army = {
						army_type = peacekeeper_army
					}
				}
				has_ground_combat = no
				is_colony = yes
			}
			while = {
				count = @pki_vassal_peacekeeper_amt
				create_army = {
					name = "Katzenarmee Peacekeeper Garrison"
					owner = event_target:pki_player
					species = event_target:pki_katzen_species
					type = "peacekeeper_army"

				}
			}
		}
	}
}

#makes peacekeepers attack at start of war
country_event = {
	id = pki_misc.212
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		pki_is_katzenartig_imperium = no
		root = { is_at_war_with = event_target:pki_player }
		from = { NOT = { has_war_flag = pki_war_peacekeepers_attack } }
		any_controlled_planet = {
			any_planet_army = {
				army_type = peacekeeper_army
			}
		}
	}
	immediate = {
		from = {
			set_war_flag = pki_war_peacekeepers_attack
		}
		every_controlled_planet = {
			limit = {
				any_planet_army = {
					army_type = peacekeeper_army
				}
			}
			every_planet_army = {
				limit = {
					army_type = peacekeeper_army
				}
				remove_army = yes
			}
			while = {
				count = @pki_vassal_peacekeeper_amt
				create_army = {
					name = "Katzenarmee Peacekeeper Garrison"
					owner = event_target:pki_player
					species = event_target:pki_katzen_species
					type = "peacekeeper_army"

				}
			}
		}
	}
}

country_event = {
	id = pki_misc.2122
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		pki_is_katzenartig_imperium = no
		root = { is_at_war_with = event_target:pki_player }
		from = { NOT = { has_war_flag = pki_war_katzen_ships_attack } }
		any_controlled_fleet = {
			any_controlled_ship = {
				pki_is_katzen_ship = yes
			}
		}
	}
	immediate = {
		from = {
			set_war_flag = pki_war_katzen_ships_attack
		}
		every_controlled_fleet = {
			limit = {
				any_controlled_ship = {
					pki_is_katzen_ship = yes
				}
			}
			set_fleet_flag = pki_has_katzen_ships
			pki_count_ships = {
				SHIP = pki_panzer
			}
			pki_count_ships = {
				SHIP = pki_bomber
			}
			pki_count_ships = {
				SHIP = pki_panzer
			}
			create_fleet = {
				name = "pki_katzen_captured_ships"
				effect = {
					set_owner = event_target:pki_player
					set_location = prev
					while = {
						count = prev.pki_katzen_panzer_count
						create_ship = {
							name = random
							random_existing_design = pki_panzer
							prefix = no
							graphical_culture = reptilian_01
							upgradable = yes

						}
					}
					while = {
						count = prev.pki_katzen_bomber_count
						create_ship = {
							name = random
							random_existing_design = pki_bomber
							prefix = no
							graphical_culture = reptilian_01
							upgradable = yes
						}
					}
					while = {
						count = prev.pki_katzen_cruiser_count
						create_ship = {
							name = random
							random_existing_design = pki_cruiser
							prefix = no
							graphical_culture = reptilian_01
							upgradable = yes
						}
					}
					set_mia = mia_return_home
				}
			}
			every_controlled_ship = {
				limit = {
					pki_is_katzen_ship = yes
				}
				delete_ship = this
			}
		}
	}
}

#War ended katzen loses
country_event = {
	id = pki_misc.213
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		fromfrom = {
			any_attacker = { pki_is_katzprotektorat = yes }
		}
		#Only fire if the loser of the war is katzen
		root = {
			pki_is_katzenartig_imperium = yes
		}
	}
	immediate = {
		fromfrom = {
			every_attacker = {
				limit = {
					pki_is_katzprotektorat = yes
				}
				remove_country_flag = pki_katzprotectorat
				set_country_flag = pki_katzprotectorat_uprising
				country_event = {
					id = pki_misc.21301
				}
			}
		}
	}
}

#Remove peacekeepers from uprising countries
country_event = {
	id = pki_misc.21301
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		any_controlled_planet = {
			any_planet_army = {
				army_type = peacekeeper_army
			}
		}
	}
	immediate = {
		every_controlled_planet = {
			limit = {
				any_planet_army = {
					army_type = peacekeeper_army
				}
				is_colony = yes
			}
			every_planet_army = {
				limit = {
					army_type = peacekeeper_army
				}
				remove_army = yes
			}
		}
	}
}

country_event = {
	id = pki_misc.220
	title = "pki_misc.220.name"
	desc = "pki_misc.220.desc"
	is_triggered_only = yes
	location = capital_scope
	picture = GFX_evt_coronation
	show_sound = event_celebration
	trigger = {
		pki_is_katzprotektorat = yes
		NOT = { exists = overlord }
	}

	option = {
		name = "pki_misc.220.a"
	}

	immediate = {
		remove_country_flag = pki_katzprotectorat
		country_event = {
			id = pki_misc.221
			days = 15 random = 15
		}
		country_event = {
			id = pki_misc.222
			days = 30 random = 30
		}
	}
}

country_event = {
	id = pki_misc.221
	title = "pki_misc.221.name"
	desc = "pki_misc.221.desc"
	is_triggered_only = yes
	location = capital_scope
	picture = GFX_evt_fleet_from_surface
	show_sound = event_ship_thrusters

	option = {
		name = "pki_misc.221.a"
	}

	immediate = {
		every_controlled_planet = {
			limit = {
				any_planet_army = {
					army_type = peacekeeper_army
				}
				is_colony = yes
			}
			every_planet_army = {
				limit = {
					army_type = peacekeeper_army
				}
				remove_army = yes
			}
		}
	}
}

country_event = {
	id = pki_misc.222
	title = "pki_misc.222.name"
	desc = "pki_misc.222.desc"
	is_triggered_only = yes
	location = capital_scope
	picture = GFX_evt_hangar_bay
	show_sound = event_ship_thrusters

	option = {
		name = "pki_misc.222.a"
	}

	immediate = {
		every_owned_fleet = {
			limit = {
				pki_is_katzen_ship = yes
			}
			set_fleet_flag = pki_has_katzen_ships
			pki_count_ships = {
				SHIP = pki_panzer
			}
			pki_count_ships = {
				SHIP = pki_bomber
			}
			pki_count_ships = {
				SHIP = pki_panzer
			}
			create_fleet = {
				name = "pki_katzen_captured_ships"
				effect = {
					set_owner = event_target:pki_player
					set_location = prev
					while = {
						count = prev.pki_katzen_panzer_count
						create_ship = {
							name = random
							random_existing_design = pki_panzer
							prefix = no
							graphical_culture = reptilian_01
							upgradable = yes

						}
					}
					while = {
						count = prev.pki_katzen_bomber_count
						create_ship = {
							name = random
							random_existing_design = pki_bomber
							prefix = no
							graphical_culture = reptilian_01
							upgradable = yes
						}
					}
					while = {
						count = prev.pki_katzen_cruiser_count
						create_ship = {
							name = random
							random_existing_design = pki_cruiser
							prefix = no
							graphical_culture = reptilian_01
							upgradable = yes
						}
					}
					set_mia = mia_return_home
				}
			}
			every_controlled_ship = {
				limit = {
					pki_is_katzen_ship = yes
				}
				delete_ship = this
			}
		}
	}
}

country_event = {
	id = pki_misc.23
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = default
		NOT = { pki_is_katzenartig_imperium = yes }
	}

	immediate = {
		add_opinion_modifier = {
			modifier = opinion_katzen_militarism
			who = event_target:pki_player
		}
	}
}

country_event = {
	id = pki_misc.24
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		pki_is_katzenartig_imperium = yes
		has_country_flag = pki_unified_flusion
		NOT = {
			check_variable = {
				which = pki_num_total_warforges
				value = value:pki_num_total_warforges
			}
		}
	}

	immediate = {
		set_variable = {
			which = pki_num_total_warforges
			value = value:pki_num_total_warforges
		}
		remove_modifier = pki_warforge_naval_cap
		add_modifier = {
			modifier = pki_warforge_naval_cap
			days = -1
			mult = value:pki_num_total_warforges
		}
	}
}

country_event = {
	id = pki_misc.25
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		resource_stockpile_compare = {
			resource = alloys
			value >= 1000
		}
		any_planet_within_border = {
			solar_system = {
				NOT = {
					count_fleet_in_system = {
						count = 4
						limit = {
							has_fleet_flag = pki_platform_planet_@prevprev
						}
					}
				}
			}
		}
		has_edict = pki_defense_station_construction
	}
	immediate = {
		random_planet_within_border = {
			limit = {
				is_star = no
				OR = {
					habitable_planet = yes
					is_planet_class = pc_pki_flusion_ecu
					is_planet_class = pc_nuked
				}
				is_artificial = no
				giga_habitable_structure = no
				is_colony = yes
				owner = {
					is_primitive = no
				}
				solar_system = {
					NOT = {
						count_fleet_in_system = {
							count = 4
							limit = {
								has_fleet_flag = pki_platform_planet_@prevprev
							}
						}
					}
				}
			}
			planet.owner = {
				add_resource = {
					alloys = -1000
				}
			}
			if = {
				limit = {
					solar_system = {
						NOT = {
							count_fleet_in_system = {
								count = 1
								limit = {
									has_fleet_flag = pki_platform_planet_@prevprev
									has_fleet_flag = pki_platform_1_@prevprev
								}
							}
						}
					}
				}
				pki_spawn_defense_fleet = {
					NUMBER = 1
				}
			}
			else_if = {
				limit = {
					solar_system = {
						NOT = {
							count_fleet_in_system = {
								count = 1
								limit = {
									has_fleet_flag = pki_platform_planet_@prevprev
									has_fleet_flag = pki_platform_2_@prevprev
								}
							}
						}
					}
				}
				pki_spawn_defense_fleet = {
					NUMBER = 2
				}
			}
			else_if = {
				limit = {
					solar_system = {
						NOT = {
							count_fleet_in_system = {
								count = 1
								limit = {
									has_fleet_flag = pki_platform_planet_@prevprev
									has_fleet_flag = pki_platform_3_@prevprev
								}
							}
						}
					}
				}
				pki_spawn_defense_fleet = {
					NUMBER = 3
				}
			}
			else_if = {
				limit = {
					solar_system = {
						NOT = {
							count_fleet_in_system = {
								count = 1
								limit = {
									has_fleet_flag = pki_platform_planet_@prevprev
									has_fleet_flag = pki_platform_4_@prevprev
								}
							}
						}
					}
				}
				pki_spawn_defense_fleet = {
					NUMBER = 4
				}
			}
		}
	}
}

planet_event = {
	id = pki_misc.26
	title = pki_misc.26.name
	desc = pki_misc.26.desc

	is_triggered_only = yes
	location = planet
	picture = GFX_evt_solaktropa_dam
	show_sound = event_construction

	option = {
		name = pki_misc.26.a
		add_deposit = d_katzen_housing_dam
	}

	option = {
		name = pki_misc.26.b
		add_deposit = d_katzen_energy_dam
	}

	option = {
		name = pki_misc.26.c
		add_deposit = d_katzen_mineral_dam
	}

	option = {
		trigger = {
			is_wet = yes
		}
		name = pki_misc.26.d
		add_deposit = d_katzen_food_dam
	}

	option = {
		name = pki_misc.26.e
		add_deposit = d_katzen_industrial_dam
		custom_tooltip = pki_industrial_dam_effects
	}

	option = {
		name = pki_misc.26.f
		fromfrom = {
			add_resource = {
				minerals = 7500
			}
		}
		hidden_effect = {
			remove_planet_flag = pki_has_dam
		}
	}
}

planet_event = {
	id = pki_misc.666
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = {
				OR = {
					is_active_resolution = "resolution_rulesofwar_reverence_for_life"
					is_active_resolution = "resolution_rulesofwar_independent_tribunals"
					is_active_resolution = "resolution_rulesofwar_last_resort_doctrine"
					is_active_resolution = "resolution_rulesofwar_demobilization_initiative"
				}
			}
			from.owner = {
				set_timed_country_flag = { flag = resolution_breached_fired_cracker days = 3600 }
			}
		}
		if = {
			limit = {
				exists = owner
				owner = {
					NOT = { is_same_value = from.owner }
					OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
				}
			}
			# Generate threat
			if = {
				limit = {
					is_colony = yes
				}
				add_threat = { who = from.owner amount = 3 }
				# modifier for allies + those upset by genocide
				every_country = {
					limit = {
						NOR = {
							is_same_value = from.owner
							is_same_value = root.owner
							AND = {
								has_federation = yes
								is_in_federation_with = from.owner
							}
						}
						OR = {
							has_communications = from.owner
							has_communications = root.owner
						}
						OR = {
							AND = {
								has_federation = yes
								is_in_federation_with = root.owner
							}
							has_ai_personality = awakened_fallen_empire_xenophile
							AND = {
								is_country_type = default
								OR = {
									is_egalitarian = yes
									is_xenophile = yes
								}
							}
						}
					}
					if = {
						limit = { root = { is_colony = no } }
						add_opinion_modifier = {
							modifier = opinion_cracked_an_uninhabited_world
							who = from.owner
						}
					}
					else = {
						add_opinion_modifier = {
							modifier = opinion_cracked_a_world
							who = from.owner
						}
					}
				}
			}
			else = {
				add_threat = { who = from.owner amount = 1 }
			}
			# modifiers for victim
			owner = {
				if = {
					limit = { root = { is_colony = no } }
					add_opinion_modifier = {
						modifier = opinion_cracked_my_uninhabited_world
						who = from.owner
					}
				}
				else = {
					add_opinion_modifier = {
						modifier = opinion_cracked_my_world
						who = from.owner
					}
				}
				if = {
					limit = { NOT = { has_ethic = ethic_gestalt_consciousness } }
					add_modifier = {
						modifier = colossus_victim
						days = 10800 # 30 years
					}
				}
			}
			if = {
				limit = {
					exists = owner
					owner = { is_country_type = primitive }
				}
				# modifier for allies + those upset by genocide
				every_country = {
					limit = {
						NOT = { is_same_value = from.owner }
						OR = {
							has_communications = from.owner
							has_communications = root.owner
						}
						OR = {
							has_ai_personality = awakened_fallen_empire_xenophile
							AND = {
								is_country_type = default
								NOR = {
									is_xenophobe = yes
									is_homicidal = yes
									is_xenophile = yes
								}
							}
						}
					}
					add_opinion_modifier = {
						modifier = opinion_cracked_a_primitive_world
						who = from.owner
					}
				}
				every_country = {
					limit = {
						NOT = { is_same_value = from.owner }
						OR = {
							has_communications = from.owner
							has_communications = root.owner
						}
						OR = {
							has_ai_personality = awakened_fallen_empire_xenophile
							AND = {
								is_country_type = default
								is_xenophile = yes
							}
						}
					}
					add_opinion_modifier = {
						modifier = opinion_cracked_a_primitive_world_phile
						who = from.owner
					}
				}
			}
		}
		if = {
			limit = {
				exists = owner
			}
			owner = {
				if = {
					limit = { #isn't the case when the crisis bombards planets, for instance
						is_at_war_with = from.fleet.owner
					}
					add_static_war_exhaustion = {
						attacker = from.fleet.owner
						location = root
						value_for_planet_destruction = 1.0
					}
				}
			}
		}
		every_owned_pop = {
			kill_pop = yes
		}
		if = {
			limit = {
				exists = orbital_defence
			}
			destroy_fleet = orbital_defence
		}
		remove_modifier = terraforming_candidate
		remove_modifier = toxic_terraforming_candidate
		remove_all_buildings = yes
		# destroy habitats and ringworlds
		if = {
			limit = {
				is_planet_class = pc_habitat
			}
			spawn_habitat_cracker_effect = yes
		}
		else_if = {
			limit = {
				is_ringworld = yes
			}
			spawn_ringworld_cracker_effect = yes
			change_pc = pc_ringworld_habitable_damaged
		}
		else_if = {
			limit = { habitable_planet = yes }
			change_pc = pc_broken
			clear_deposits = yes
			random_list = {
				1 = {
					add_deposit = d_minerals_10
					add_deposit = d_minerals_6
				}
				1 = {
					add_deposit = d_minerals_10
					add_deposit = d_minerals_2
				}
				1 = {
					add_deposit = d_minerals_8
				}
				1 = {
					add_deposit = d_minerals_4
				}
			}
			solar_system = {
				if = {
					limit = {
						prev = {
							is_cold = yes
						}
					}
					spawn_planet = {
						class = pc_ice_asteroid
						location = prev
						orbit_distance = 5
						orbit_angle = 90
						size = 2
						init_effect = {
							pki_set_asteroid_name = yes
							random_list = {
								1 = {
									add_deposit = d_trade_value_1
								}
								1 = {
									add_deposit = d_trade_value_3
								}
								1 = {
									add_deposit = d_energy_1
								}
								1 = {
									add_deposit = d_energy_3
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						prev = {
							is_planet_class = pc_crystal
						}
					}
					spawn_planet = {
						location = prev
						orbit_distance = 5
						orbit_angle = 90
						size = 2
						class = pc_ice_asteroid
						init_effect = {
							pki_set_asteroid_name = yes
							random_list = {
								1 = {
									add_deposit = d_energy_1
								}
								1 = {
									add_deposit = d_energy_3
								}
								1 = {
									add_deposit = d_rare_crystals_1
								}
								1 = {
									add_deposit = d_rare_crystals_3
								}
							}
						}
					}
				}
				else = {
					spawn_planet = {
						location = prev
						orbit_distance = 5
						orbit_angle = 90
						size = 2
						class = pc_asteroid
						init_effect = {
							pki_set_asteroid_name = yes
							random_list = {
								1 = {
									add_deposit = d_trade_value_1
								}
								1 = {
									add_deposit = d_trade_value_3
								}
								1 = {
									add_deposit = d_minerals_1
								}
								1 = {
									add_deposit = d_minerals_3
								}
							}
						}
					}
				}
			}
		}
		else = {
			change_pc = pc_broken
			clear_deposits = yes
			solar_system = {
				if = {
					limit = {
						prev = {
							giga_is_barren_cold = yes
						}
					}
					spawn_planet = {
						location = prev
						orbit_distance = 5
						orbit_angle = 90
						size = 2
						class = pc_ice_asteroid
						init_effect = {
							pki_set_asteroid_name = yes
							random_list = {
								1 = {
									add_deposit = d_trade_value_1
								}
								1 = {
									add_deposit = d_trade_value_3
								}
								1 = {
									add_deposit = d_energy_1
								}
								1 = {
									add_deposit = d_energy_3
								}
							}
						}
					}
				}
				else = {
					spawn_planet = {
						location = prev
						orbit_distance = 5
						orbit_angle = 90
						size = 2
						class = pc_asteroid
						init_effect = {
							pki_set_asteroid_name = yes
							random_list = {
								1 = {
									add_deposit = d_trade_value_1
								}
								1 = {
									add_deposit = d_trade_value_3
								}
								1 = {
									add_deposit = d_minerals_1
								}
								1 = {
									add_deposit = d_minerals_3
								}
							}
						}
					}
				}
			}
		}
	}
}