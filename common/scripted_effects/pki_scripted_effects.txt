pki_district_half = {
    export_trigger_value_to_variable = {
        trigger = num_districts
        parameters = {
            type = $DISTRICT$
        }
        variable = $VARIABLE$
    }
    divide_variable = { which = $VARIABLE$ value = 2 }
    floor_variable = $VARIABLE$
    while = {
        count = $VARIABLE$
        remove_district = $DISTRICT$
    }
    clear_variable = $VARIABLE$
}

pki_district_var_set = {
    export_trigger_value_to_variable = {
        trigger = num_districts
        parameters = {
            type = $DISTRICT$
        }
        variable = $VARIABLE$
    }
    divide_variable = { which = $VARIABLE$ value = 2 }
    floor_variable = $VARIABLE$
}

pki_district_convert = {
    while = {
        count = $VARIABLE$
        add_district = $DISTRICT$
    }
    clear_variable = $VARIABLE$
}

pki_spawn_warforge_fleet = {
    create_fleet = {
        name = "Katzenkriegsschmiedekanone"
        settings = {
            spawn_debris = no
        }
        effect = {
            set_owner = $OWNER$
            if = {
                limit = {
                    fromfrom = {
                        space_owner = {
                            NOT = {
                                pki_is_katzenartig_imperium = yes
                            }
                        }
                    }
                }
                set_owner = event_target:pki_warforge_country
            }
            create_ship = {
                name = "Katzenkriegsschmiedekanone"
                design = "Rhawn"
                upgradable = no
            }
            set_location = fromfrom
            set_fleet_flag = warforge_platform
            set_fleet_flag = warforge_platform@fromfrom
        }
    }
    if = {
        limit = {
            space_owner = {
                pki_is_katzprotektorat = yes
            }
        }
        every_system_planet = {
            limit = {
                has_planet_flag = war_forge
            }
            add_modifier = {
                modifier = pki_warforge_in_orbit
                days = -1
            }
        }
    }
}

pki_refrest_army_limit = {
    set_variable = {
        which = pki_$ARMY$_current
        value = 0
    }
    every_owned_army = {
        if = {
            limit = {
                army_type = $ARMY$_army
            }
            prev = {
                change_variable = {
                    which = pki_$ARMY$_current
                    value = 1
                }
            }
        }
    }
}

pki_set_army_limits = {
    set_variable = {
        which = pki_katzensoldaten_limit
        value = 5
    }

    set_variable = {
        which = pki_gepanzertertank_limit
        value = 3
    }

    set_variable = {
        which = pki_atmospharischekatzenbomber_limit
        value = 3
    }
}

pki_refresh_all_army_limits = {
    pki_refrest_army_limit =  {ARMY = katzensoldaten}
    pki_refrest_army_limit =  {ARMY = gepanzertertank}
    pki_refrest_army_limit =  {ARMY = atmospharischekatzenbomber}
}

pki_setup_flusion_economy = {
    event_target:pki_flusion_planet = {
        add_deposit = d_pki_economic_mechanics
    }

    set_variable = {
        which = pki_industry_level
        value = @pki_KAT_industry_level
    }

    set_variable = {
        which = pki_used_industry
        value = 0
    }
}

pki_spawn_defense_fleet = {
    create_fleet = {
        name = "Katzenplanetenverteidigung"
        settings = { spawn_debris = no }
        effect = {
            set_owner = root
            create_ship = {
                name = "Katzenplanetenverteidigung"
                random_existing_design = pki_warforge_platform
                upgradable = yes
            }
            set_location = {
                target = prev
                distance = 10
                angle = @\[90*($NUMBER$ - 1) ]
            }
            set_fleet_flag = pki_platform_planet_@prev
            set_fleet_flag = pki_platform_$NUMBER$_@prev
        }
    }
}

pki_count_ships = {
    every_controlled_ship = {
        fleet = {
            set_variable = {
                which = pki_$SHIP$_count
                value = 0
            }
        }
        limit = {
            is_ship_size = $SHIP$
        }
        fleet = {
            change_variable = {
                which = pki_$SHIP$_count
                value = 1
            }
        }
    }
}

pki_yearly_migration = {
    every_owned_planet = {
        limit = {
            NOR = {
                has_planet_flag = pki_flusion_planet
                has_modifier = no_relocation
            }
            count_owned_pop = {
                count >= 15
            }
        }
        every_owned_pop = {
            random_list = {
                $HIGH_BOUND$ = {
                }
                $LOW_BOUND$ = {
                    resettle_pop = {
                        pop = THIS
                        planet = event_target:pki_flusion_planet
                    }
                }
            }
        }
    }
    event_target:pki_flusion_planet = {
        add_modifier = {
            modifier = temp_job_help
            days = 1
        }
    }
}

pki_update_galactic_tension = {
    every_situation = {
        limit = {
            is_situation_type = situation_pki_galactic_tension
        }
        owner = {
            set_variable = {
                which = pki_galaxy_owned
                value = value:pki_galaxy_owned
            }
        }
        add_situation_progress = value:pki_set_situation_progress_effect|NEW_PROGRESS|owner.pki_galaxy_owned|
    }
}

pki_generate_corrona_primitives_on_planet = {
    create_species = {
        name = "Skeletoid"
        plural = "Skeletoids"
        class = corrona
        portrait = corrona1
        namelist = MAM1
        homeworld = THIS
        traits = {
            trait = trait_pc_continental_preference
            trait = trait_enduring
            trait = trait_quarrelsome
            trait = trait_strong
            trait = trait_resilient
        }
        effect = {
            save_global_event_target_as = pki_corronaskeletons
        }
    }
    create_country = {
        name = "Corronian Kingdoms"
        name_list = random
        authority = auth_oligarchic
        civics = {
            civic = civic_increasing_urbanization
            civic = civic_atmospheric_pollution
        }
        species = last_created_species
        ethos = {
            ethic = ethic_xenophobe
            ethic = ethic_authoritarian
            ethic = ethic_spiritualist
        }
        flag={
            icon={
                category="spherical"
                file="flag_spherical_19.dds"
            }
            background={
                category="backgrounds"
                file="circle.dds"
            }
            colors={
                "grey"
                "beige"
                "null"
                "null"
            }
        }
        type = primitive
    }
    last_created_country = {
        set_graphical_culture = industrial_01
        set_country_flag = tech_frozen
        set_country_flag = custom_preftl_diplomacy
        set_country_flag = custom_preftl_espionage
        set_country_flag = corrona_age
        set_pre_ftl_age = giga_corrona_age
        set_country_flag = corrona_primitives
        save_global_event_target_as = pki_corrona_country
    }
    while = {
        count = 20
        create_pop = {
            species = event_target:pki_corronaskeletons
        }
    }
    while = { count = 10   create_army = { name = NAME_bone	   	  owner = last_created_country species = event_target:pki_corronaskeletons type = "corrona_army" } }
    while = { count = 1	   create_army = { name = NAME_madknight  owner = last_created_country species = event_target:pki_corronaskeletons type = "corrona_army" } }
    remove_building = building_colony_shelter
    remove_all_buildings = yes
    add_building = building_giga_corrona_homes
    add_building = building_giga_corrona_homes
    add_building = building_giga_corrona_homes
    add_building = building_giga_corrona_capital
    create_pre_ftl_blockers = yes
}

pki_create_corrona_dragon_fleet_corrona = {
    create_leader = {
        class = commander
        species = event_target:pki_corronaskeletons
        name = random
        skill = 3
        gender = male
        effect = {
            save_event_target_as = pki_corrona_admiral
        }
    }
    create_fleet = {
        name = "Draconic Horde"
        settings = {
            uses_naval_capacity = no
            spawn_debris = no
            can_change_composition = no
            can_change_leader = no
            can_upgrade = no
            can_disband = no
        }
        effect = {
            set_fleet_flag = pki_corrona_dragon_fleet
            set_owner = event_target:pki_corrona_country
            while = {
                count = 25
                create_ship = {
                    name = random
                    design = "Beast of War"
                    prefix = no
                }
            }
            assign_leader = event_target:pki_corrona_admiral
            set_location = {
                target = event_target:pki_corrona
                distance = 10
                angle = random
            }
        }
    }
}

pki_clear_map_selector_mults = {
    remove_country_flag = pki_map_industry_mult_1
    remove_country_flag = pki_map_industry_mult_10
    remove_country_flag = pki_map_industry_mult_100
}

pki_map_annex = {
    if = {
        limit = {
            any_country = {
                is_country_type = pki_flusion_nation
                has_country_flag = pki_$COUNTRY$
            }
        }
        set_country_flag = pki_map_annexed_$COUNTRY$
        change_variable = {
            which = pki_industry_level
            value = event_target:pki_$COUNTRY$_country.pki_industry_level
        }
        event_target:pki_flusion_planet = {
            add_deposit = d_pki_$COUNTRY$
            while = {
                count = event_target:pki_$COUNTRY$_country.pki_pops
                create_pop = {
                    species = event_target:pki_$COUNTRY$_species
                    ethos = random
                    effect = {
                        add_modifier = {
                            modifier = pop_recently_conquered
                            days = 1800
                        }
                    }
                }
            }
        }
        every_country = {
            limit = {
                is_country_type = pki_flusion_nation
                has_country_flag = pki_$COUNTRY$
            }
            destroy_country = yes
        }
    }
}

pki_map_clear = {
    remove_country_flag = pki_map_occupied_$COUNTRY$
    remove_country_flag = pki_map_annexed_$COUNTRY$
}

pki_map_occupy = {
    set_country_flag = pki_map_occupied_$COUNTRY$
}

pki_annex_all = {
    pki_all_countries_effect = {
        EFFECT = pki_map_annex
    }
}

pki_occupy_all = {
    pki_all_countries_effect = {
        EFFECT = pki_map_occupy
    }
}

pki_clear_all = {
    pki_all_countries_effect = {
        EFFECT = pki_map_clear
    }
}

pki_all_countries_effect = {
    $EFFECT$ = {
        COUNTRY = ATA
    }
    $EFFECT$ = {
        COUNTRY = AXO
    }
    $EFFECT$ = {
        COUNTRY = BYU
    }
    $EFFECT$ = {
        COUNTRY = CYA
    }
    $EFFECT$ = {
        COUNTRY = DTC
    }
    $EFFECT$ = {
        COUNTRY = GNA
    }
    $EFFECT$ = {
        COUNTRY = GTA
    }
    $EFFECT$ = {
        COUNTRY = HAR
    }
    $EFFECT$ = {
        COUNTRY = HOS
    }
    $EFFECT$ = {
        COUNTRY = ILY
    }
    $EFFECT$ = {
        COUNTRY = KIT
    }
    $EFFECT$ = {
        COUNTRY = KRK
    }
    $EFFECT$ = {
        COUNTRY = KRO
    }
    $EFFECT$ = {
        COUNTRY = LAU
    }
    $EFFECT$ = {
        COUNTRY = LIN
    }
    $EFFECT$ = {
        COUNTRY = MER
    }
    $EFFECT$ = {
        COUNTRY = NDK
    }
    $EFFECT$ = {
        COUNTRY = NDR
    }
    $EFFECT$ = {
        COUNTRY = NEK
    }
    $EFFECT$ = {
        COUNTRY = NOR
    }
    $EFFECT$ = {
        COUNTRY = PFL
    }
    $EFFECT$ = {
        COUNTRY = PGM
    }
    $EFFECT$ = {
        COUNTRY = PHH
    }
    $EFFECT$ = {
        COUNTRY = POZ
    }
    $EFFECT$ = {
        COUNTRY = PRO
    }
    $EFFECT$ = {
        COUNTRY = RAV
    }
    $EFFECT$ = {
        COUNTRY = ROQ
    }
    $EFFECT$ = {
        COUNTRY = RUS
    }
    $EFFECT$ = {
        COUNTRY = SAR
    }
    $EFFECT$ = {
        COUNTRY = SOB
    }
    $EFFECT$ = {
        COUNTRY = TER
    }
    $EFFECT$ = {
        COUNTRY = VIX
    }
    $EFFECT$ = {
        COUNTRY = WAC
    }
    $EFFECT$ = {
        COUNTRY = WIN
    }
    $EFFECT$ = {
        COUNTRY = YIN
    }
    $EFFECT$ = {
        COUNTRY = ZUS
    }
}

pki_set_asteroid_name = {
    random_list = {
        1 = { set_name = "giga_generic_asteroid_1" set_planet_flag = random_asteroid_name_1 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_1 } } } }
        1 = { set_name = "giga_generic_asteroid_2" set_planet_flag = random_asteroid_name_2 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_2 } } } }
        1 = { set_name = "giga_generic_asteroid_3" set_planet_flag = random_asteroid_name_3 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_3 } } } }
        1 = { set_name = "giga_generic_asteroid_4" set_planet_flag = random_asteroid_name_4 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_4 } } } }
        1 = { set_name = "giga_generic_asteroid_5" set_planet_flag = random_asteroid_name_5 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_5 } } } }
        1 = { set_name = "giga_generic_asteroid_6" set_planet_flag = random_asteroid_name_6 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_6 } } } }
        1 = { set_name = "giga_generic_asteroid_7" set_planet_flag = random_asteroid_name_7 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_7 } } } }
        1 = { set_name = "giga_generic_asteroid_8" set_planet_flag = random_asteroid_name_8 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_8 } } } }
        1 = { set_name = "giga_generic_asteroid_9" set_planet_flag = random_asteroid_name_9 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_9 } } } }
        1 = { set_name = "giga_generic_asteroid_10" set_planet_flag = random_asteroid_name_10 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_10 } } } }
        1 = { set_name = "giga_generic_asteroid_11" set_planet_flag = random_asteroid_name_11 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_11 } } } }
        1 = { set_name = "giga_generic_asteroid_12" set_planet_flag = random_asteroid_name_12 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_12 } } } }
        1 = { set_name = "giga_generic_asteroid_13" set_planet_flag = random_asteroid_name_13 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_13 } } } }
        1 = { set_name = "giga_generic_asteroid_14" set_planet_flag = random_asteroid_name_14 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_14 } } } }
        1 = { set_name = "giga_generic_asteroid_15" set_planet_flag = random_asteroid_name_15 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_15 } } } }
        1 = { set_name = "giga_generic_asteroid_16" set_planet_flag = random_asteroid_name_16 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_16 } } } }
        1 = { set_name = "giga_generic_asteroid_17" set_planet_flag = random_asteroid_name_17 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_17 } } } }
        1 = { set_name = "giga_generic_asteroid_18" set_planet_flag = random_asteroid_name_18 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_18 } } } }
        1 = { set_name = "giga_generic_asteroid_19" set_planet_flag = random_asteroid_name_19 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_19 } } } }
        1 = { set_name = "giga_generic_asteroid_20" set_planet_flag = random_asteroid_name_20 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_20 } } } }
        1 = { set_name = "giga_generic_asteroid_21" set_planet_flag = random_asteroid_name_21 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_21 } } } }
        1 = { set_name = "giga_generic_asteroid_22" set_planet_flag = random_asteroid_name_22 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_22 } } } }
        1 = { set_name = "giga_generic_asteroid_23" set_planet_flag = random_asteroid_name_23 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_23 } } } }
        1 = { set_name = "giga_generic_asteroid_24" set_planet_flag = random_asteroid_name_24 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_24 } } } }
        1 = { set_name = "giga_generic_asteroid_25" set_planet_flag = random_asteroid_name_25 modifier = { factor = 0 solar_system = { any_system_planet = { has_planet_flag = random_asteroid_name_25 } } } }
    }
}

pki_create_conquest_armies = {
    create_leader = {
        name = random
        species = root.owner_main_species
        class = commander
        traits = {
            trait = pki_leader_trait_battle_mechanics
        }
        skill = 3
        randomize_traits = yes
        can_manually_change_location = no
        can_assign_to_council = no
        hide_leader = yes
        leader_age_min = 20
        leader_age_max = 40
        effect = {
            random_list = {
                25 = {
                    add_trait_no_notify = pki_leader_trait_inexperienced_general
                }
                75 = {

                }
            }
            last_created_army = {
                assign_leader = last_created_leader
            }
        }
    }
    while = {
        count = pki_current_army_points
        random_list = {
            4 = {
                modifier = {
                    factor = 0
                    event_target:pki_player = {
                        NOT = {
                            has_country_flag = pki_panzer_core_formed
                        }
                    }
                }
                modifier = {
                    factor = 0
                    check_variable = {
                        which = pki_current_army_points
                        value < 4
                    }
                }
                event_target:pki_flusion_planet = {
                    fleet = {
                        queue_actions = {

                        }
                    }
                    create_army = {
                        owner = event_target:pki_conquest_target
                        type = pki_flusion_tanks
                    }
                }
            }
            1 = {
                modifier = {
                    factor = 0
                    check_variable = {
                        which = pki_current_army_points
                        value < 2
                    }
                }
                event_target:pki_flusion_planet = {
                    create_army = {
                        owner = event_target:pki_conquest_target
                        type = pki_flusion_special_forces
                        species = event_target:pki_conquest_target.owner_main_species
                    }
                }
            }
            2 = {
                modifier = {
                    factor = 0
                    check_variable = {
                        which = pki_current_army_points
                        value < 1
                    }
                }
                modifier = {
                    factor = 999
                    event_target:pki_player = {
                        has_modifier = pki_pre_ftl_military_1
                    }
                }
                modifier = {
                    factor = 3
                    event_target:pki_player = {
                        has_modifier = pki_pre_ftl_military_2
                    }
                }
                modifier = {
                    factor = 2
                    event_target:pki_player = {
                        has_modifier = pki_pre_ftl_military_3
                    }
                }
                event_target:pki_flusion_planet = {
                    create_army = {
                        owner = event_target:pki_conquest_target
                        type = assault_army
                        species = event_target:pki_conquest_target.owner_main_species
                    }
                }
            }
            1 = {
                modifier = {
                    factor = 999
                    check_variable = {
                        which = pki_current_army_points
                        value = 0
                    }
                }
                ## hehe nothing lmao
            }
        }
    }
    create_fleet = {
        name = "guh"
        effect = {
            set_owner = this
            while = {
                count = 1
                create_army_transport = {
                    army_type = dominion_tracks
                    army_name = "NAME_dominiontracks"
                    ship_name = "NAME_dominiontracks"
                }

            }
            set_location = {
                target = event_target:pki_flusion_planet
            }
        }
    }
    last_created_army = {
        assign_leader = last_created_leader
    }
    set_variable = {
        which = pki_current_army_points
        value = pki_army_count
    }
    
    
}

pki_end_battle_effects = {
    every_country = {
        limit = {
            is_country_type = pki_flusion_nation
        }
        set_faction_hostility = { set_hostile = no }
    }
    event_target:pki_flusion_planet = {
        army_leader = {
            remove_trait = pki_leader_trait_battle_mechanics
        }
        set_controller = event_target:pki_player
        every_planet_army = {
            limit = {
                owner = {
                    pki_is_katzenartig_imperium = no
                }
            }
            remove_army = yes
        }
        remove_modifier = pki_air_combat
        root = {
            divide_variable = {
                which = pki_num_fighters
                value = 100
            }
            ceiling_variable = pki_num_fighters
            divide_variable = {
                which = pki_num_cas
                value = 100
            }
            ceiling_variable = pki_num_cas
        }
        while = {
            count = root.pki_num_fighters
            create_army = {
                name = random
                owner = root
                type = pki_air_fighter
            }
        }
        while = {
            count = root.pki_num_cas
            create_army = {
                name = random
                owner = root
                type = pki_air_cas
            }
        }
    }
    event_target:pki_conquest_target = {
        set_variable = {
            which = pki_planes_count
            value = pki_num_fighters
        }
        change_variable = {
            which = pki_planes_count
            value = pki_num_cas
        }
        divide_variable = {
            which = pki_planes_count
            value = 100
        }
        floor_variable = pki_planes_count
    }
}

pki_remove_ethics = {
    country_remove_ethic = ethic_militarist
    country_remove_ethic = ethic_fanatic_militarist
    country_remove_ethic = ethic_xenophobe
    country_remove_ethic = ethic_fanatic_xenophobe
    country_remove_ethic = ethic_egalitarian
    country_remove_ethic = ethic_fanatic_egalitarian
    country_remove_ethic = ethic_materialist
    country_remove_ethic = ethic_fanatic_materialist
    country_remove_ethic = ethic_pacifist
    country_remove_ethic = ethic_fanatic_pacifist
    country_remove_ethic = ethic_xenophile
    country_remove_ethic = ethic_fanatic_xenophile
    country_remove_ethic = ethic_authoritarian
    country_remove_ethic = ethic_fanatic_authoritarian
    country_remove_ethic = ethic_spiritualist
    country_remove_ethic = ethic_fanatic_spiritualist
}

pki_guh = {

}